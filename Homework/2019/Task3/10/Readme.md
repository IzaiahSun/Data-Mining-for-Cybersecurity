# XSS检测

## 1、test1

### 1.1、实验环境

- keras
- gensim
- python3.0

### 1.2、实验内容

1. 使用 word2vec_ginsim.py训练嵌入式词向量

2. 运行processing.py预处理数据，生成训练数据和测试数据。

3. SVM.py使用支持向量训练模型并测试模型的准确率和召回率

4. predict_xss 使用训练好的模型预测输入的语句有没有可能是XSS攻击

#### 1.2.1、分词

分词原则为：

- 单双引号包含的内容 ‘xss’
- http/https链接
- <>标签 < script>
- <>开头 < h1
- 参数名 topic=
- 函数体 alert(
- 字符数字组成的单词  另外，为了减小分词数量，需要把数字和超链接范化，将数字替换为”0”,超链接替换为http://u

#### 1.2.2、嵌入式词向量

  使用嵌入式词向量模型建立一个XSS的语义模型，让机器能够理解< script>、alert()这样的HTML语言。取正样例中出现次数最多的5000个词，构成词汇表，其他的词标记为“UKN”，使用gensim模块的word2vec类建模，词空间维度取128维，词与向量的映射关系如下图所示：

![vec](Screen\vec.png)

#### 1.2.3、数据预处理

 通过建立好的词向量模型，使用空间向量表示一个文本



### 1.3、实验结果

运行结果如下图所示：

![1](Screen\1.png)



## 2、test2

### 2.1、实验环境

- python3
- sklearn

### 2.2、实验内容

运行xssRF.py

一、首先进行特征选取，这里选取了四个特征，分别是：url长度、url中包含的第三方域名的个数、敏感字符（如[、<、>、/、]、）的个数、敏感关键字（例如：alert、script=、%3c、%3e、%20、onerror)的个数。

二、形成特征向量。

三、进行数据拆分，使用70%作为训练数据。

四、选用随机森林算法训练模型，首先使用网格搜索确定要建立的基学习器个数，再使用网格搜索来确定决策树的参数，根据得到的最大层数与最多棵树的参数，建立最终的随机森林来预测模型。



#### 2.2.1、RF框架参数说明：

1、n_estimators:随机森林的基学习器数量

2、oob_score:是否使用袋外数据来评价模型



#### 2.2.2、基学习器参数说明：

1、max_features：在做决策树时候选择的特征数量 。默认是"None",意味着划分时考虑所有的特征数；如果是"log2"意味着划分时最多考虑log2Nlog2N个特征；如果是"sqrt"或者"auto"意味着划分时最多考虑N??√N个特征。

2、criterion：决策树划分的衡量，gini是基尼系数，回归树种是mse均方误差

3、max_depth：决策树的最大深度

4、min_samples_split:最小划分的样本数，如果低于这个样本数，决策树不做划分



### 2.3、实验结果

根据得到的最大层数81与最多棵树8，模型的训练结果如下图所示：

![2](Screen\2.png)

## 3、test3

### 3.1、实验环境

- python3

### 3.2、实验内容

运行myXSS.ipynb

本程序通过自定义特征选取通过研究XSS攻击中出现的几个典型特征，将原始数据集向量化，将数据分为测试集与训练集，并将处理好的数据输入决策树、随机森林等多种模型算法进行训练，使用测试集得到各个模型的准确率与召回率的值。

#### 3.2.1 特征选取

​	本项目选取的特征为：

- 是否含有"**script**"
- 是否含有"**alert**"
- 是否含有"**<**"
- 是否含有"**>**"
- 是否含有"**%*"
- 是否含有"**\ '**"
- 是否含有"**(**"
- 是否含有"**)**"

### 3.3、实验结果

运行后得到各算法的准确率和召回率如下图所示：

![3](Screen\3.png)